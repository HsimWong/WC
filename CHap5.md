# 5	创建动态刺激（文本展示以及运动刺激）
#### 学习目标：
在PsychoPy中，你可以用时间函数连续地展示刺激。例如，你可以让刺激“跳动”起来，引起年幼被试的兴趣。或者，你也可以让这些刺激逐渐地出现。再次我们将以多种方式学习如何用时间函数来控制刺激。

<p></p>
本章节中，我们将介绍一种刺激性质的概念。这种刺激性质可以在诗词的每一帧中被刷新。有了这些动态的性质，你可以以时间函数的形式，改变刺激的大小、朝向和位置。与之前的章节中仅创建单个实验所不同的是，本章节中我们将使用多个样例。我们将创建一些示例来展示效果，例如让文本逐渐展示、旋转，以及延展图片，制造一个跳动的心脏！
<p></p>
为了让这些能够变化的平滑、好看，一点点高中数学知识将会非常有用。所以我们在附录A当中附上了复习内容。
<p></p>
我们同样也应该注意到，创建动态刺激对于大多数任务来说并不是*必要*的。通常情况下这被认为是非常奢侈的——有些许炫耀的嫌疑——可是一旦你了解到，在每一帧当中展示的东西*可以*被做一些改变，这就为你提供了创建实验的新的可能性。如果我们介绍的内容的编程水平不适合你，请你不要担心——你可以不去使用它，就呈现一些更加“标准的”刺激就好了。
## 5.1 *动态*是什么意思？它为什么会有用？
相比较其他许多相似的软件包来说，PsychoPy的不寻常之处在于它将时间作为实验结构的中心。这样做的目的是物体能够一起或者独立地出现或者消失。因此，在一个PsychoPy的动作组中，其表现方式如同一个轨道编辑器，正如你在视频或音频软件里看到的那样。请考虑“延迟样本匹配”（delayed match-to-sample）任务的设计。在这个设计中你会呈现一个*样本*图像，而一段延迟后悔紧跟着几个选项，包括*目标（target）*和*陪衬（foil）*。其中，只有目标和样本相同。每个试次都会由你的注视点开始。其中，注视点应该在500 ms处出现来提示被试。在试次剩下的时间里，注视点都应该保持可见。*样本*可能出现在注视点的上方，然后紧接着马上消失。经过一小段暂停之后，应该同时出现一对刺激，并且在被试做出决定前保持可见。在PsychoPy里，这个试次的即时输出将会非常清晰（请看图5-1）
<p></p>
时间轴试图仅仅显示了刺激的时间安排。例如，我们不能从视图中看出目标和陪衬将在相对于注视点上空间的那个位置出现。为了找出其空间安排（以及其他显示设置，例如颜色和朝向），我们需要点击刺激图标来查看其属性。
#### 情报信息：其他的软件包是如何操作的？
与PsychoPy相反，许多软件包将一个试次更多地看作为一张幻灯片，而不是带有轨道的视频。这就意味着，你看到的是一连串受试者将要在屏幕上看到的图像。实验中物体同时出现或者消失的地方，这将会非常方便。然而在许多研究中，刺激并不是同时出现或者消失的。这就意味着一个试次将会需要很多幻灯片来表示。举个例子，在延迟样本匹配中，试次可能在前固定阶段（pre-fixation period）需要一张幻灯片，而在注视点单独出现需要另一张幻灯片，在注视点和*样本*图像都出现后还需要一张幻灯片，然后在回到只有一个注视点的哪一张，最后一张是注视点外加目标和陪衬刺激。一连串的幻灯片这种方法的有点事其空间设计在每一个幻灯变种更容易地被可视化，而其缺点是它的时间组织很难被确定。
<p></p>
因为PsychoPy是一时间作为实验设计为中心的，所以它也让你能*基于*时间来控制刺激。你已经看到了，我们可以将大多数组件参数设置为“每次重复时更新”。例如我们可以诚信一张图片在每一个试次中都有变化。但是大多数刺激参数同样可以“每一帧进行刷新”（在每一次显示器进行物理刷新的时候）。这就意味着图片可以在试次*期间*平滑地运动（例如移动）。在每次屏幕刷新的时候，参数的值都会被检查，而且可以被改变为新的值。同样地，因为PsychoPy使用硬件加速图形（hardware-accelerated graphics）（即繁重的工作是由显卡（graphics card）上专用的处理器完成的），大多数的变化将会被非常迅速地实施，所以在实验当中连续地操纵刺激，通常情况下不会对实验的计时的保真度（timing fidelity）产生损坏。
<p></p>对于现在来说，有一件要解决的事情：如果这些变化通常以60Hz的频率发生（大多是显示器每秒钟更新60次），这就意味着你需要提供好些数值来满足它的更新需求。而把这些数值敲进条件文件，正如我们在之前的章节中做的那样，将会话费很长时间。在普通的显示器上，每秒钟的刺激呈现我们将需要60行条件文件！幸运的是，PsychoPy有一个强大的替代方法来刷一点花招：你可以通过使用等式（或者任何原生Python代码）来指定数值作为PsychoPy刺激的参数。这就让你可以通过数学表达式，或者对事件的回应，来控制刺激。例如，你可以让图像位置的确定取决于时间，或者让反馈声音的音调与按钮按下的次数相关。
## 5.2 在参数中插入代码
当你学习过如何在PsychoPy中创建基础实验后，你会发现在参数中插入```$```符号会告诉PsychoPy跟在其后面的是一个变量的名称，而不是简单地一段文本。你可能会认为，是“```$```告诉了PsychoPy这是一个变量的名称”。而事实要比这宽泛得多。它告诉PsychoPy“这个文本框里面包含的是Python代码”，而你写的变量名又是Python中是有效的代码，那么它就被翻译成了变量名

### 让我们开始动手吧！
那么现在让我们将刺激的位置改变。为了做这件事，我们应该让其位置根据当前动作组的时间来更新。在所有的Builder实验中，都会有一个非常有用的变量叫做```t```。它提供了当前动作组（无论是什么动作组）从开始到现在的秒数。我们在流程上用单个动作组创建一个实验，在这个动作组上增加文本组件。现在我们可以将文字组件的位置进行设置，例如```(t,0)```，并且通过使用设置右方的下拉菜单，让其在**每一帧**进行更新。刺激的位置是由一对由括号括起来的一对数值控制的。这对数值对应值其*x*和*y*坐标。所以```(t, 0)```意味着刺激的水平位置被设置为```t```，而它随着时间的变化而变化。而他的垂直位置停留在```y=0```（也就是中垂线）。所以当动作组开始的时候，刺激将会出现在屏幕的中央```(0, 0)```。一秒钟之后它将会在```(1, 0)```的位置。这在归一化单位中在屏幕的右手端，但是在垂直方向上仍然是在中央的。两秒钟之后它的位置将会在```(2, 0)```，而这个位置在归一化单位中超出了屏幕范围，所以并不可见（关于单位的更进一步信息请参见第十一章节）。
<p></p>
在这个例子中，你可以简单滴通过操纵```t```的数值来增加或者减慢你的刺激的速度。如果你讲位置设置为```(t * 0.25, 0)```，那么你的刺激将会以之前的四分之一的速度移动，花费四秒钟的时间运动到右手边的边缘位置，即```(4 * 0.25, 0)```。你也可以改变开始的位置，只需要增加或者减小数值。例如，表达式```(-1 + t * 0.5, 0)```将会使得刺激从左手边屏幕的边缘(1, 0)开始向右，以每秒钟0.5个单位移动移动。
<p></p>
移动的速率取决于刺激的```单位```设置。默认情况下，每个刺激的这个参数都被设置为*归一化*的（事实上，默认的刺激单位是从实验设置继承来的，而实验设置又是从PsychoPy的偏好里继承的*归一化*这个默认情况）。你可能发现，将刺激的单位设置为*像素*会更加直观，这样一来速度（由```t```来控制）的单位会变成*像素每秒*。所以在一秒钟之后，位置设置为```(t, 0)```、单位设置为```像素```的刺激，只会向右运动到中心偏右的一个像素的位置，而使用**归一化**单位的刺激将会一直移动到屏幕右手边的边缘位置。如果你讲单位改变为使用像素，请不要忘记也要将尺寸设置（或者，文字组件字母高度）改变为以像素为单位的合适的数值。要不然，你可能会发现自己看不到刺激了。这是因为你将它画得比一个像素还要小！
<p></p>
## 5.3	例1：逐渐揭示文本
通过使用让物体移动的技巧，创建一个效果来给被试逐渐显示一句话将会变得非常简单。也许，你想要精确控制句子显示给被试时的速率吧？
<p></p>为了做这件事，我们可以先使用文字对象来来绘制我们的句子（而它可以在每个试次中根据条件文件而改变，正如之前的例子一样）。在此之后，我们只需要在其上方绘制绘制蒙版（mask），逐渐地将其移除以展示在其下方的文本刺激。
<p></p>
我们来创建一个实验，其中要包含一个动作组和一个文字组件。文字组件里面要有一些句子作为文本，而它需要足够长，这样我们才能看出来它在逐渐地揭示。但是也不要太长，应该让它合适于屏幕宽度。像“被试何时能明白句子的意思？”这句就比较何时。现在，在屏幕上的文字大约占据了屏幕的一半的大小（在使用归一化单位的情况下），但是我们想让整句话延展后超过屏幕。我们可以在文字组件的高级设置中将环绕宽度（wrap width）设置为2，如图5-2所示。
<p></p>
直到目前，一切进行得非常顺利。而创建蒙版这部分是新内容。请注意，动作组中的物体是按照顺序进行绘制的，即从上到下。所以，处在“低位”的物体要被稍晚一点绘制，因此先前绘制的物体会被虚化（假设它们都是不透明的）。所以你需要保证蒙版在时间轴仕途上处于文字组件的*下方*。而你的机构应该与图5-3类似。
<p></p>我们创建蒙版的方式有很多种类。例如。我们可以将光栅（```Grating```）和图像组件（```Image Component```）以蒙版的方式使用。这就使得我们可以通过确定边数目（三角形为3，矩形为4，五边形为5，以此类推知道无心接近圆形）来创建正多边形。在此之后，你需要确定正多边形的宽度和高度。在我们这个例子中，我们需要将边数设置为4：```vertices = 4```，将尺寸设置为```size = (2, 0.5)```，如图5-4那样。通过将尺寸设置为2，以及将单位这职位归一化单位，我们可以保证蒙版最开始可以覆盖屏幕的整个宽度。我们又将高度设置为0.5，但是它也可以是任何数值，只需要比我们要模糊的目标文字大即可。
<p></p>
这个任务的关键所在是将位置动态地进行设置，例如有表达式```(t * 0.5)```，以便于可以逐渐揭示文本。再次说明，你可让通过改变0.5这个数值让蒙版移动得快一点或者慢一点。你甚至可以将其用你条件文件里的变量```maskSpeed```进行替换，来使得蒙版移动的速度在不同试次见有区分。
<p></p>
首先，若将蒙版的默认颜色（白色）不作处理，以便能够设置它在默认灰色背景中的移动方式，你可能会在概念上受到帮助。一旦你明白了它正在做的事情后，你可以将其颜色设置为与北京相同。为了完成这件事情，需要在多边形的填充颜色（```fillColor```）和线条颜色```lineColor```设置中（参见图5-5）将他们设置为灰色（或者你屏幕的颜色。在实验设置中可以控制）。当蒙版和背景颜色一致时，会让人感觉文字是逐渐被揭示的。而蒙版的运动不会非常明显。
<p></p>
此时你应该有了一句通过蒙版滑动而揭示的句子了。
#### 专业建议
对于你来说，通过*位置*相对于*时间*的等式来考虑速度这件事若是很困难的话，那么请问自己一个问题：我的刺激在t=0以及t=1的时候应该在什么位置？大多数情况下，弄清楚这两个时间点的位置应该足够让你明白运动应该是什么样子了。

## 5.4	例2：将图像旋转、延展
能够根据时间变化的不仅仅是位置。许多其他的参数也有相同的能力。让我们找一些著名的面孔图像吧。我们将使他们旋转，还会让它们从微小状态逐渐扩大，直到它们能够让人看见为止。我们会要求被试在能够识别出面孔的瞬间按下按钮。

#### 情报信息：为什么我们可以让面孔旋转扩折延展？
旋转、延展面孔从科学的角度来说并不清晰，但是在上世界八九十年代的电视节目上，它是一个非常流行的挑战项目。参加比赛的人需要识别有名的人的面孔。

<p></p>
请下载一些名人的面部图像，并且将他们放置在一个文件夹中。将这个文件夹命名为```faces```，并且将图片明明为```face01.jpg, face02.jpg```，等等。
<p></p>接下来在Builder视图中创建一个实验，在其中带有一个动作组（默认情况下有一个动作组叫做```trial```），然后在动作组中插入图像组件。具体的参数在下面给出（同样如图5-6所示）
- start: ```0.0```
- stop: ```10.0```
- image:```$imageFile```
- size: ```$t * 40```
- orientation: ```$t * 180```
- units: ```pix```
在我们这个样例中，刺激的尺寸在```t = 0```的时候从零开始，在此之后以40个像素每秒钟的大小扩大，与此同时以每秒钟180度的速率旋转。这对于让被试困惑这一点来说已经足够了。

## 5.5	例3：按照彩虹的样子改变颜色
连续改变颜色以是可能的，而这也可以引起被试的兴趣。为了完成这件事，我们可能会通过编程用数字定义颜色。PsychoPy提供了集中颜色空间（color space）来完成这件事，而详细情况将在11.2章节中详细描述。对于这个任务来说最合适的颜色空间可能是```HSV```。在其中，第一个颜色数值决定了它的色度（彩虹颜色为基准），而通常认为它以圆的角度（0~360度）来表示。第二个数值决定了它的饱和度（你可以认为它表示颜色的强度），其取值范围为0~1。第三个参数，也是最后一个值简单地被叫做“数值”，它松散地对应着颜色的亮度（取值方位同样为0~1）。所以，为了让刺激在彩虹的颜色范围内变化（请参考图4-7和4-8），我们可以将刺激的颜色空间设置为```HSV```（这在文字组件的高级设置里（```Advanced Settings```）），并且将其设置为```$(t * 90, 1, 1)```，而这会导致一个强烈的（因为 S=1）、明亮的（因为υ=1）颜色以彩虹的颜色变化（因为*h*为变量）。由于一个完整的光谱内的颜色变化是360度，在使用```t*90```的情况下将会话费4秒钟的时间来完成。你可以尝试着通过使用```$(t * 90, 0.5, 1)```来降低色彩的饱和度来得到一个粉彩效果的版本，或者将“数值”降低```(t * 90, 1, 0.5)```来得到一个暗一点的版本。为了让颜色变化更加迅速，可以简单地将数值从```t * 90```变化到```t * 180```。
#### 专业建议：HSV颜色
颜色通常是通过分离红、绿、蓝的数值来确定的，而你可能会在这本书的其他地方也经常见过。它们的特性是不同的：与其在彩环上选择一个点（没有自然的起点或终点），它设置了三个滑块，每个滑块都有确定的最小值和最大值。当我们想要独立控制这三个颜色通道时，这是有用的，但是它不像HSV颜色空间那样容易在彩虹颜色中循环。您可以对其他对象执行类似的更改，如多边形或光栅组件，或任何其他支持颜色设置的对象。

## 5.6	例4：制作一个有脉搏的心脏
知道目前为止，所有的变化都有一个连续地方向，但是当我们想让位置、朝向或者尺寸线进行变换，然后在平滑地变换回来呢？在这个展示中我们将会创建会改变尺寸的物体，但是我们将会通过让其扩大后再缩回来以准备下一个循环的方式来让其尺寸进行变化。让物体有节奏地移动（例如弹跳）或者增长后再缩回来最贱的的做法是使用*正弦函数*（*sine*）波形。你可以在附录A中读到什么是*正弦*和*余弦*的内容（在第281页）。
<p></p>
**创建一个心形**。对于这个样例来说你可以使用任何你喜欢的图形，但是在心形上的效果是最好的。不要使用照片——那会非常恶心！我们想要的是一个卡通版的“爱心”。你可以从互联网上获取一张简单的包含心形图像，或者你可以使用在线资料当中包含的那一个，然后再将其转换为图像组件（请参阅第三章）。最好找一张心形的外边是透明的图像。这样的话，无论窗口的背景颜色是什么，都将会被正确地显示，也就不会出现会泽屏幕上有一个白色的方框，中间还有一个红色的心形这种情况了（真恶心！）。

#### 专业建议：让图片的颜色也变化起来
如果你想控制心脏的颜色，那么你应该将心脏绘制为白色，将背景设置为黑色，并且将其想刺激蒙版一样使用。这样一来白色部分就会可见，并且可以变换颜色，而黑色部分是不可见的，会显示为背景的颜色。请参阅16.3章节来获取关于将图像作为蒙版使用的更多信息。
<p></p>**改变尺寸**。你可能回忆起高中数学中正弦曲线波形（sinusoidal wave）上下运动，在-1~+1中间平滑地变化。所以我们可以使用```sin(t)```来得到一个根据时间来变换的波形。然而我们需要将这个简单的函数进行跳帧个，因为它的值域为-1到+1，而一个图形的大小为-1看上去非常奇怪。如果我们将尺寸确定为```4 + sin(t)```，那么在波峰的位置我们将得到的大小为5（即```4+1```），而在波形的最消除我们将会得到的尺寸为3（即```4 + (-1)```），这样一来将会让我们看到物体的尺寸一直在正数范围内平滑地变换。然而如果我们将单位设置为“像素”，3到5这个范围内的尺寸将会展现出一个非常小的心脏。所以，我们让其有一个大一点的尺寸（100个像素），然后再让波形有更大一点的振幅（amplitude）例如```50 * sin(t)```。然而这会让脉搏跳动的非常缓慢。所以我们可以在正弦函数应用之前将```t```乘以3。这会使得变换加速。现在的话，刺激大小的总等式将会是```100 + 50 + sin(t * 3)```。这会使得尺寸在50到150个像素的范围内平滑地来回变换。将其插入到你的图像刺激当中。你可以在图5-9当中看到它的样子。让其运行起来，你将看到心形在很好地增大然后缩小。
<p></p>
**让脉搏看起来更像一个脉搏**。请注意正弦曲线波形并不真正地产生像脉搏一样的效果。它变化得太过平滑了，而一个卡通版跳动心脏应该在大多数时间里是做小的，只在相对很短的时间里变大。对我们的等式的一点小小的改动将会使得它看起来更像一些。如果过我们将正弦曲线乘方，那么他会改变曲线的形状，，让它变得更尖。试着使用等式$100+50\times sin(t\times 3)^{4}$。而这个式子用Python语法来实现写作```100 + 50 * sin(t * 3) ** 4```（其中“\*\*”表示将后面的数字看做乘方）。如果你擅长数学的话，你可能会注意到这将脉搏的频率变为了原来的两倍（正弦曲线的负波瓣（negative lobe）变成了正数。但是现在让我们不要操心这些，它能工作就行了。

[]译者注：文中的“等式”一词在原文中对应“equation”。单根据内容来看应该为“expression”（表达式）更为妥当。为了保留原文特色，将不做更改。
[]译者注：根据后续内容，此处的表达式应该为$100+50\times sin^{4}(t\times 3)$。Python的乘方运算自动将前面的正弦函数包含进来。

## 5.7 更进一步
除了将Python代码添加到组件的参数之外（这显然只能有一行），还可以向代码组件中添加更多代码（你可以在组件面板里的“个性化”（Custom）组别里面找到按钮）。这些组件能够让你将无限行任意的Python代码添加到脚本的各个部分。更多的信息请参考第六章。

### 练习与扩展
#### 练习5.1	通过改变不透明度揭示图像
请注意不透明度是一个从0（完全透明，不可见）变换到1（完全不透明，所以完全可见）。你可以用两种方式揭示图像。你可以让图像逐渐增加不透明度，或者你可以绘制一个刺激在紧跟着某种蒙版。而蒙版的不透明度逐渐减少，后面的刺激就展示出来了。尝试上述的每一种方式，并且记住，当使用等式设置不透明度时候，请记住它需要在每一帧都更新（```update every frame```）。
<p></p>答案：287页
#### 练习5.2	旋转的眼球
为了制作一对简单的眼球，你需要四个对象：两个白色的眼睛和两个瞳孔。他们可为止可以在注视点的两侧，并且使瞳孔以正弦曲线的模式左右移动。你可以不断缩小放大运动的振幅（使用乘法）以及运动的中心（用加法或者减法）。
- 不要在这个情况中使用归一化单位，因为用它们来绘制圆形瞳孔是非常难得。请使用“高度”、“像素”、“厘米”中你觉得舒服的单位
- 请确保将眼睛白色椭圆形的部分首先绘制，然后在绘制瞳孔（在动作组视图中，让表示瞳孔的组件放置在眼白部分的下方）。
- 在你调试所有设置的饰扣，从一个眼睛开始。当你完成了一个眼睛后，你可以右击组件，然后“复制”、“粘贴”进去（“粘贴组件”位于Builder的实验菜单```Experiment```里面，或者通过```Ctrl-Alt-V```来访问。这样一来，第二只眼睛的所有设置将会被直接完成，而剩下的事情只有改变它的位置了。
<p></p>答案：287页